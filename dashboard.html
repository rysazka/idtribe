    <!DOCTYPE html>
    <html lang="id">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <title>Dashboard - ID-TRIBE</title>
        <link rel="icon" type="image/png" href="favicon.png">
        
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Plus+Jakarta+Sans:wght@400;500;700&display=swap" rel="stylesheet">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
        
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        
        <script type="module" src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
        <script type="module" src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>
        <script type="module" src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>

        <style>
            /* --- 1. MODERN THEME & VARIABLES --- */
            :root {
                --primary: #059669;
                --primary-dark: #047857;
                --primary-light: #d1fae5;
                --accent: #f59e0b;
                --accent-glow: #fbbf24;
                --dark: #0f172a;
                --text-gray: #64748b;
                
                /* Glassmorphism */
                --glass-bg: rgba(255, 255, 255, 0.85);
                --glass-border: 1px solid rgba(255, 255, 255, 0.6);
                --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.05);
                
                --card-radius: 20px; /* Radius sedikit diperkecil */
                --font-head: 'Outfit', sans-serif;
                --font-body: 'Plus Jakarta Sans', sans-serif;
            }

            * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

            body {
                font-family: var(--font-body);
                background-color: #f0fdf4;
                color: var(--dark);
                min-height: 100vh;
                padding-top: 80px; 
                padding-bottom: 40px;
                overflow-x: hidden;
                background-image: 
                    radial-gradient(at 0% 0%, hsla(152,100%,93%,1) 0, transparent 50%), 
                    radial-gradient(at 100% 100%, hsla(43,100%,93%,1) 0, transparent 50%);
            }

            /* ORNAMENTS (BLOBS) */
            .bg-shapes { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }
            .blob { position: absolute; border-radius: 50%; filter: blur(80px); opacity: 0.6; animation: float 10s infinite alternate; }
            .blob-1 { top: -10%; left: -10%; width: 500px; height: 500px; background: var(--primary-light); }
            .blob-2 { bottom: 10%; right: -5%; width: 400px; height: 400px; background: #fef3c7; animation-delay: -5s; }
            @keyframes float { 0% { transform: translateY(0); } 100% { transform: translateY(30px); } }


            /* --- 2. TOP NAVIGATION --- */
            .top-nav {
                position: fixed; top: 0; left: 0; width: 100%; height: 80px;
                background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(16px);
                border-bottom: var(--glass-border);
                display: flex; align-items: center; justify-content: space-between;
                padding: 0 5%; z-index: 1000; box-shadow: var(--glass-shadow);
                transition: all 0.3s ease;
            }

            .brand {
                font-family: var(--font-head); font-size: 1.6rem; font-weight: 800; color: var(--dark);
                display: flex; align-items: center; gap: 8px; text-decoration: none; letter-spacing: -0.5px;
            }
            .brand span { color: var(--primary); }

            .user-section { display: flex; align-items: center; gap: 20px; }
            .avatar {
                width: 42px; height: 42px; background: linear-gradient(135deg, var(--accent), var(--accent-glow));
                border-radius: 12px; display: flex; align-items: center; justify-content: center;
                color: white; font-weight: 800; font-size: 1rem; box-shadow: 0 4px 10px rgba(245, 158, 11, 0.3);
            }
            
            .logout-btn {
                border: none; background: #fee2e2; padding: 10px 20px;
                border-radius: 50px; cursor: pointer; color: #b91c1c; font-weight: 700;
                font-size: 0.9rem; transition: 0.3s; font-family: var(--font-body);
                display: flex; align-items: center; gap: 8px;
                box-shadow: 0 4px 10px rgba(239, 68, 68, 0.15);
            }
            .logout-btn:hover { 
                background: #ef4444; color: white; transform: translateY(-2px);
                box-shadow: 0 6px 15px rgba(239, 68, 68, 0.3);
            }

            /* --- 3. MAIN HERO --- */
            .main-content { width: 100%; max-width: 1200px; margin: 0 auto; }

            .hero {
                height: 320px;
                background-image: url('https://images.unsplash.com/photo-1619338098121-5925681fc9ab?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&q=80&w=1080');
                background-size: cover; background-position: center;
                position: relative; border-radius: 0 0 40px 40px;
                display: flex; align-items: center; padding: 0 50px;
                margin-bottom: 60px; box-shadow: 0 20px 50px rgba(0,0,0,0.15);
            }
            .hero-overlay {
                position: absolute; inset: 0; border-radius: 0 0 40px 40px;
                background: linear-gradient(to right, rgba(6, 78, 59, 0.95), rgba(6, 78, 59, 0.7));
            }
            .hero-content { position: relative; z-index: 10; width: 100%; color: white; animation: fadeInUp 0.8s ease-out; }
            @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

            .level-badge {
                display: inline-block; padding: 8px 20px; background: rgba(255,255,255,0.15);
                backdrop-filter: blur(10px); border-radius: 50px; border: 1px solid rgba(255,255,255,0.3);
                font-size: 0.85rem; margin-bottom: 20px; font-weight: 700; letter-spacing: 1px; text-transform: uppercase;
            }
            
            .progress-wrapper { max-width: 400px; margin-top: 30px; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 16px; backdrop-filter: blur(5px); }
            .progress-bg { height: 10px; background: rgba(255,255,255,0.2); border-radius: 20px; overflow: hidden; margin-top: 8px; }
            .progress-fill { height: 100%; background: var(--accent); width: 0%; transition: width 1.5s cubic-bezier(0.22, 1, 0.36, 1); border-radius: 20px; box-shadow: 0 0 10px rgba(245, 158, 11, 0.5); }

            .dashboard-container {
                padding: 0 40px; margin-top: -100px; position: relative; z-index: 20;
            }

            /* --- 4. CARDS & GRID (UPDATED SIZE) --- */
            .matrix-grid {
                display: grid;
                /* Update: 4 Kolom Sejajar Proporsional */
                grid-template-columns: repeat(4, 1fr); 
                gap: 20px; 
                margin-bottom: 40px;
            }

            .card {
                background: var(--glass-bg); backdrop-filter: blur(12px);
                border-radius: var(--card-radius); 
                padding: 20px; /* Padding dikurangi agar card tidak terlalu besar */
                box-shadow: var(--glass-shadow); border: var(--glass-border);
                transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                display: flex; flex-direction: column; height: 100%;
                position: relative; overflow: hidden;
            }
            .card:hover { transform: translateY(-8px); border-color: var(--primary); box-shadow: 0 15px 35px rgba(5, 150, 105, 0.15); }

            .card.locked { opacity: 0.85; background: #f8fafc; border: 2px dashed #cbd5e1; filter: grayscale(0.8); }
            .card.locked:hover { transform: none; box-shadow: none; border-color: #cbd5e1; }
            
            .card.unlocked::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 5px; background: var(--primary); }

            .icon-box {
                width: 48px; height: 48px; border-radius: 12px;
                display: flex; align-items: center; justify-content: center;
                font-size: 1.5rem; margin-bottom: 15px; transition: 0.3s;
            }
            .locked .icon-box { background: #e2e8f0; color: var(--text-gray); }
            .unlocked .icon-box { background: var(--primary-light); color: var(--primary); box-shadow: 0 6px 15px rgba(5, 150, 105, 0.2); }

            /* Font Size Adjusted for Compact Cards */
            .card h3 { font-family: var(--font-head); font-size: 1.1rem; margin-bottom: 8px; color: var(--dark); font-weight: 800; }
            .card p { font-size: 0.85rem; color: var(--text-gray); margin-bottom: 20px; flex-grow: 1; line-height: 1.5; }

            .btn-card {
                width: 100%; padding: 10px; border-radius: 10px;
                text-align: center; text-decoration: none; font-size: 0.85rem; font-weight: 700;
                transition: all 0.3s; cursor: pointer; border: none; font-family: var(--font-body);
            }
            .btn-locked { background: #e2e8f0; color: var(--text-gray); cursor: not-allowed; }
            .btn-active { 
                background: linear-gradient(135deg, var(--primary), var(--primary-dark)); 
                color: white; box-shadow: 0 6px 15px rgba(5, 150, 105, 0.3); 
            }
            .btn-active:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(5, 150, 105, 0.4); }

            /* --- 5. SPLIT SECTION --- */
            .split-section { display: grid; grid-template-columns: 1.8fr 1.2fr; gap: 30px; }

            .section-title { 
                font-family: var(--font-head); font-size: 1.3rem; font-weight: 800; margin-bottom: 20px; 
                display: flex; align-items: center; gap: 12px; color: var(--dark);
            }
            .section-icon { 
                width: 36px; height: 36px; background: var(--primary-light); border-radius: 10px; 
                display: flex; align-items: center; justify-content: center; color: var(--primary); font-size: 1rem; 
            }

            /* List Item */
            .list-container { display: flex; flex-direction: column; gap: 12px; }
            .list-item {
                display: flex; align-items: center; justify-content: space-between;
                padding: 15px; border-radius: 16px; background: white;
                border: 1px solid #f1f5f9; transition: 0.3s; cursor: default;
            }
            .list-item:hover { transform: translateX(5px); border-color: var(--primary-light); box-shadow: 0 4px 15px rgba(0,0,0,0.03); }
            
            .list-rank {
                width: 28px; height: 28px; background: #f1f5f9; border-radius: 50%;
                display: flex; align-items: center; justify-content: center;
                font-weight: 800; color: var(--text-gray); font-size: 0.8rem; margin-right: 12px;
            }
            .rank-1 { background: #fef3c7; color: #d97706; }
            
            .list-info { flex: 1; min-width: 0; }
            .list-title { font-weight: 700; color: var(--dark); font-size: 0.9rem; margin-bottom: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
            .list-sub { font-size: 0.75rem; color: var(--text-gray); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}
            
            .list-score { font-weight: 800; color: var(--accent); font-family: var(--font-head); font-size: 0.9rem; }

            .chart-container { position: relative; height: 320px; width: 100%; padding: 10px; }

            /* --- MOBILE RESPONSIVE --- */
            @media (max-width: 1024px) {
                .matrix-grid { grid-template-columns: repeat(2, 1fr); } /* Tablet 2 Kolom */
            }

            @media (max-width: 768px) {
                body { padding-top: 70px; padding-bottom: 40px; }
                .top-nav { padding: 0 20px; height: 70px; }
                .brand { font-size: 1.4rem; }
                
                .hero { 
                    margin-bottom: 40px; padding: 0 25px; height: auto; padding-top: 40px; padding-bottom: 80px;
                    border-radius: 0 0 30px 30px; 
                }
                .hero-overlay { border-radius: 0 0 30px 30px; }
                .hero h1 { font-size: 1.8rem; }
                
                .dashboard-container { padding: 0 20px; margin-top: -60px; }
                
                /* Mobile Stack (1 Kolom) */
                .matrix-grid { grid-template-columns: 1fr; gap: 15px; margin-bottom: 30px; }
                .split-section { grid-template-columns: 1fr; gap: 25px; }
                
                .chart-container { height: 250px !important; }
                
                /* Horizontal Card on Mobile */
                .matrix-grid .card { 
                    flex-direction: row; align-items: center; min-height: auto; padding: 15px;
                }
                .matrix-grid .icon-box { margin-bottom: 0; margin-right: 15px; width: 45px; height: 45px; font-size: 1.4rem; flex-shrink: 0; }
                .matrix-grid .card-content { flex: 1; }
                .matrix-grid .card h3 { font-size: 1rem; margin-bottom: 2px; }
                .matrix-grid .card p { display: none; } /* Hide desc on mobile for compactness */
                .matrix-grid .btn-card { width: auto; padding: 8px 16px; font-size: 0.8rem; margin-left: 10px; }
                .card.unlocked::before { width: 4px; height: 100%; top: 0; left: 0; } 
            }
        </style>
    </head>
    <body>

        <div class="bg-shapes">
            <div class="blob blob-1"></div>
            <div class="blob blob-2"></div>
        </div>

        <nav class="top-nav">
            <a href="#" class="brand">ID<span>TRIBE</span></a>
            <div class="user-section">
                <div style="text-align: right; display: none; @media(min-width:768px){display:block;}">
                    <div style="font-weight:700; font-size:0.9rem;" id="navName">Loading...</div>
                    <div style="font-size:0.75rem; color:var(--text-gray);">Owner</div>
                </div>
                <div class="avatar" id="userAvatar">U</div>
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Keluar
                </button>
            </div>
        </nav>

        <main class="main-content">
            <div class="hero">
                <div class="hero-overlay"></div>
                <div class="hero-content">
                    <span class="level-badge" id="levelBadge">Loading...</span>
                    <h1 style="font-size: 2.5rem; margin-bottom: 10px; font-family: var(--font-head); font-weight: 800;">Halo, <span id="userName">Partner</span> üëã</h1>
                    <p style="opacity: 0.9; font-size: 1.1rem;" id="userBusiness">Memuat data...</p>
                    
                    <div class="progress-wrapper">
                        <div style="display: flex; justify-content: space-between; font-size: 0.85rem; margin-bottom: 8px; font-weight: 600;">
                            <span>Kesehatan Bisnis</span>
                            <span id="progressText">0%</span>
                        </div>
                        <div class="progress-bg">
                            <div class="progress-fill" id="levelProgress"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="dashboard-container">
                
                <div class="matrix-grid">
                    
                    <div class="card unlocked" id="cardTraining">
                        <div class="icon-box">üéì</div>
                        <div class="card-content">
                            <h3>Training Hub</h3>
                            <p>Akses modul belajar & skill.</p>
                        </div>
                        <a href="training-hub.html" class="btn-card btn-active">Akses</a>
                    </div>

                    <div class="card locked" id="cardDigital">
                        <div class="icon-box">üöÄ</div>
                        <div class="card-content">
                            <h3>Digital Tools</h3>
                            <p>Marketplace & Tools.</p>
                        </div>
                        <button class="btn-card btn-locked" onclick="showLockReason('Digital Empowerment', 'Digital: Advanced')">Terkunci</button>
                    </div>

                    <div class="card locked" id="cardPartnership">
                        <div class="icon-box">ü§ù</div>
                        <div class="card-content">
                            <h3>Partnership</h3>
                            <p>Kolaborasi B2B Supply.</p>
                        </div>
                        <button class="btn-card btn-locked" onclick="showLockReason('Partnership', 'Legal/Ops/Network: Intermediate+')">Terkunci</button>
                    </div>

                    <div class="card locked" id="cardFinancing">
                        <div class="icon-box">üí∞</div>
                        <div class="card-content">
                            <h3>Akses Modal</h3>
                            <p>Pendanaan syariah.</p>
                        </div>
                        <button class="btn-card btn-locked" onclick="showLockReason('Financing', 'Finance: Adv ATAU Legal: Int')">Terkunci</button>
                    </div>

                </div>

                <div class="split-section">
                    
                    <div class="card" style="padding: 25px;">
                        <div class="section-title">
                            <div class="section-icon"><i class="fas fa-chart-pie"></i></div>
                            Radar Kompetensi
                        </div>
                        <div class="chart-container">
                            <canvas id="healthRadar"></canvas>
                        </div>
                    </div>

                    <div style="display: flex; flex-direction: column; gap: 25px;">
                        
                        <div class="card" style="padding: 25px;">
                            <div class="section-title">
                                <div class="section-icon"><i class="fas fa-lightbulb"></i></div>
                                Rekomendasi Belajar
                            </div>
                            <div id="learningList" class="list-container">
                                <p class="text-muted" style="text-align:center;">Memuat data...</p>
                            </div>
                        </div>

                        <div class="card" style="padding: 25px;">
                            <div class="section-title">
                                <div class="section-icon"><i class="fas fa-trophy"></i></div>
                                Top UMKM
                            </div>
                            <div id="leaderboardList" class="list-container">
                                <p class="text-muted" style="text-align:center;">Memuat...</p>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </main>

        <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
            import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
            import { getFirestore, doc, getDoc, collection, query, limit, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

            const firebaseConfig = {
                apiKey: "AIzaSyBIaLzkNM0KqPVKxuMNmardLqcrr2kYTWQ",
                authDomain: "database-idbm.firebaseapp.com",
                projectId: "database-idbm",
                storageBucket: "database-idbm.firebasestorage.app",
                messagingSenderId: "1052290789133",
                appId: "1:1052290789133:web:36b513630b7a87154eca44",
                measurementId: "G-EQLBB94DY2"
            };

            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);

            // Helper: Convert Level String to Number
            const getScore = (lvl) => {
                if (lvl === 'Advanced') return 3;
                if (lvl === 'Intermediate') return 2;
                return 1; // Beginner
            };

            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    const docRef = doc(db, "users_umkm", user.uid);
                    const docSnap = await getDoc(docRef);

                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        renderDashboard(data);
                        loadLeaderboard(data.nama_usaha);
                    } else {
                        window.location.href = "setup-umkm.html";
                    }
                } else {
                    window.location.href = "login.html";
                }
            });

            window.logout = function() {
                signOut(auth).then(() => window.location.href = "index.html");
            }

            function renderDashboard(data) {
                const shortName = data.nama_lengkap.split(' ')[0];
                document.getElementById('userName').innerText = shortName;
                if(document.getElementById('navName')) document.getElementById('navName').innerText = shortName;
                document.getElementById('userAvatar').innerText = shortName.charAt(0).toUpperCase();
                document.getElementById('userBusiness').innerText = data.nama_usaha + " ‚Ä¢ " + (data.kategori || "UMKM");

                // LEVEL PROGRESS
                const levels = data.competency_levels || { digital: "Beginner", finance: "Beginner", legal: "Beginner", ops: "Beginner", network: "Beginner" };
                let totalScore = 0;
                for(let k in levels) totalScore += getScore(levels[k]);
                let avgScore = (totalScore / 15) * 100;
                
                let levelLabel = "Beginner";
                if(avgScore > 60) levelLabel = "Intermediate";
                if(avgScore > 90) levelLabel = "Advanced";

                document.getElementById('levelBadge').innerText = levelLabel + " Level";
                document.getElementById('levelProgress').style.width = `${avgScore}%`;
                document.getElementById('progressText').innerText = `${Math.round(avgScore)}%`;

                // UNLOCK LOGIC
                if (getScore(levels.digital) >= 3) unlockCard('cardDigital', '#');
                if (getScore(levels.finance) >= 3 || getScore(levels.legal) >= 2) unlockCard('cardFinancing', '#');
                if (getScore(levels.legal) >= 2 || getScore(levels.ops) >= 2 || getScore(levels.network) >= 3) unlockCard('cardPartnership', '#');

                renderChart(levels);
                generateLearningPath(levels);
            }

            function unlockCard(id, link) {
                const card = document.getElementById(id);
                if(card) {
                    card.classList.remove('locked');
                    card.classList.add('unlocked');
                    const btn = card.querySelector('button, a');
                    const newBtn = document.createElement('a');
                    newBtn.className = 'btn-card btn-active';
                    newBtn.href = link;
                    newBtn.innerText = 'Akses';
                    btn.replaceWith(newBtn);
                }
            }

            window.showLockReason = (feature, reason) => {
                alert(`Fitur '${feature}' Terkunci!\n\nSyarat Membuka:\n${reason}\n\nSilakan tingkatkan level Anda dengan mengikuti ujian di Training Hub.`);
            }

            function renderChart(levels) {
                const ctx = document.getElementById('healthRadar').getContext('2d');
                const dataScores = [
                    getScore(levels.finance),
                    getScore(levels.digital),
                    getScore(levels.legal),
                    getScore(levels.ops),
                    getScore(levels.network)
                ];

                if(window.myRadar) window.myRadar.destroy();

                window.myRadar = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: ["Finance", "Digital", "Legal", "Ops", "Network"],
                        datasets: [{
                            label: 'Kompetensi',
                            data: dataScores,
                            fill: true,
                            backgroundColor: 'rgba(5, 150, 105, 0.2)',
                            borderColor: '#059669',
                            pointBackgroundColor: '#059669',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: '#059669'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            r: {
                                min: 0, max: 3,
                                ticks: { stepSize: 1, display: false },
                                grid: { color: '#e2e8f0' },
                                pointLabels: { font: { size: 11, family: 'Outfit' }, color: '#64748b' }
                            }
                        },
                        plugins: { legend: { display: false } }
                    }
                });
            }

            function generateLearningPath(levels) {
                const container = document.getElementById('learningList');
                container.innerHTML = "";
                let modules = [];
                if(levels.finance === 'Beginner') modules.push({title: "Dasar Keuangan", tag: "Finance"});
                if(levels.legal === 'Beginner') modules.push({title: "Urus Legalitas NIB", tag: "Legal"});
                if(levels.digital === 'Beginner') modules.push({title: "Digital Marketing 101", tag: "Digital"});

                if(modules.length === 0) {
                    container.innerHTML = `<div class="list-item"><span style="font-size:0.9rem;">Selamat! Level Anda sudah tinggi.</span></div>`;
                } else {
                    modules.forEach(mod => {
                        container.innerHTML += `
                        <div class="list-item" onclick="window.location.href='training-hub.html'">
                            <div class="list-info">
                                <div class="list-title">${mod.title}</div>
                            </div>
                            <span style="font-size:0.7rem; font-weight:700; background:#fff7ed; color:#f59e0b; padding:4px 10px; border-radius:20px;">${mod.tag}</span>
                        </div>`;
                    });
                }
            }

            async function loadLeaderboard(currentUserBusiness) {
                const listEl = document.getElementById('leaderboardList');
                try {
                    const q = query(collection(db, "users_umkm")); 
                    const querySnapshot = await getDocs(q);
                    let leaderboardData = [];

                    querySnapshot.forEach((doc) => {
                        const d = doc.data();
                        let total = 0;
                        const levels = d.competency_levels || { digital: "Beginner", finance: "Beginner", legal: "Beginner", ops: "Beginner", network: "Beginner" };
                        for(let k in levels) total += getScore(levels[k]);
                        let realScore = Math.round((total / 15) * 100);
                        if (d.status_setup !== "completed") realScore = 0;
                        leaderboardData.push({ data: d, score: realScore });
                    });

                    leaderboardData.sort((a, b) => b.score - a.score);
                    const top5 = leaderboardData.slice(0, 5);

                    listEl.innerHTML = ""; 
                    if (top5.length === 0) { listEl.innerHTML = '<div style="text-align:center; font-size:0.8rem; color:#64748b;">Belum ada data.</div>'; return; }

                    let rank = 1;
                    top5.forEach((item) => {
                        const d = item.data;
                        const isMe = d.nama_usaha === currentUserBusiness;
                        const bgStyle = isMe ? "background: #f0fdf4; border-color: #dcfce7;" : "";
                        const rankClass = rank === 1 ? "rank-1" : "";
                        
                        const html = `
                        <div class="list-item" style="${bgStyle}">
                            <div class="list-rank ${rankClass}">${rank}</div>
                            <div class="list-info">
                                <div class="list-title" style="${isMe ? 'color:var(--primary);' : ''}">${d.nama_usaha || "User Baru"}</div>
                                <div class="list-sub">${d.kategori || "-"}</div>
                            </div>
                            <div class="list-score">${item.score}</div>
                        </div>`;
                        listEl.innerHTML += html;
                        rank++;
                    });
                } catch (e) {
                    console.error("Leaderboard Error:", e);
                    listEl.innerHTML = '<div style="text-align:center; font-size:0.8rem; color:red;">Gagal memuat.</div>';
                }
            }
        </script>
    </body>
    </html>