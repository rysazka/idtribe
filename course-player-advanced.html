<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kelas Digital Advanced - ID-TRIBE</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <script type="module" src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>

    <style>
        /* --- DESIGN SYSTEM --- */
        :root {
            --forest-green: #2E5C48;
            --golden-orange: #F2994A;
            --blue-advanced: #0ea5e9; /* Sky Blue for Advanced */
            --text-dark: #1a1a1a;
            --text-muted: #64748b;
            
            /* Glass Effect */
            --glass-bg: rgba(255, 255, 255, 0.95);
            --glass-border: rgba(255, 255, 255, 0.5);
            --glass-blur: blur(20px);
            --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
        }

        body { font-family: 'Lato', sans-serif; background: var(--forest-green); color: var(--text-dark); margin: 0; padding-bottom: 50px; }
        
        .bg-image {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('https://images.unsplash.com/photo-1619338098121-5925681fc9ab?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&q=80&w=1920');
            background-size: cover; background-position: center; z-index: -2;
        }
        .bg-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, rgba(46, 92, 72, 0.95), rgba(46, 92, 72, 0.8)); z-index: -1;
        }

        .nav-top { padding: 20px 20px 0; max-width: 1100px; margin: 0 auto; position: relative; z-index: 10; }
        .nav-top a { color: rgba(255,255,255,0.8); text-decoration: none; font-weight: 600; display: flex; align-items: center; gap: 8px; }
        .nav-top a:hover { color: white; }

        .container { max-width: 1100px; margin: 0 auto; padding: 20px; display: grid; grid-template-columns: 2fr 1fr; gap: 30px; position: relative; z-index: 10; }

        /* Video Section */
        .video-section { position: sticky; top: 20px; height: fit-content; }
        .video-box {
            width: 100%; aspect-ratio: 16/9; background: black; border-radius: 16px; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            border: 4px solid rgba(255,255,255,0.1); overflow: hidden; position: relative;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }
        .progress-bar-container { position: absolute; bottom: 0; left: 0; width: 100%; height: 6px; background: rgba(255,255,255,0.2); }
        .progress-bar-fill { height: 100%; background: var(--blue-advanced); width: 0%; transition: width 0.2s linear; }

        .info-card {
            background: var(--glass-bg); padding: 25px; border-radius: 16px; border: 1px solid var(--glass-border); 
            margin-top: 20px; box-shadow: var(--glass-shadow); backdrop-filter: var(--glass-blur);
        }

        /* Syllabus */
        .syllabus-card { background: white; border-radius: 16px; padding: 20px; box-shadow: var(--glass-shadow); }
        .syllabus-item { display: flex; align-items: center; gap: 12px; padding: 12px; border-bottom: 1px solid #f1f5f9; color: var(--text-muted); font-size: 0.9rem; }
        .syllabus-item.active { background: #f0f9ff; border-radius: 8px; border-bottom: none; color: var(--blue-advanced); font-weight: 600; }
        .icon-type { width: 24px; text-align: center; font-size: 1.1rem; }

        /* Buttons */
        .btn { padding: 12px 25px; border-radius: 10px; cursor: pointer; border: none; font-weight: 700; width: 100%; margin-top: 15px; transition: all 0.3s; font-size: 0.95rem; }
        .btn-primary { background: var(--blue-advanced); color: white; }
        .btn-primary:hover { background: #0284c7; }
        .btn-success { background: #10b981; color: white; }
        .btn-warning { background: var(--golden-orange); color: white; }
        .btn-disabled { background: #e2e8f0; color: #94a3b8; cursor: not-allowed; }
        .btn-cert { background: linear-gradient(135deg, #38bdf8, #0ea5e9); color: white; display: flex; align-items: center; justify-content: center; gap: 10px; }

        /* Quiz Modal */
        .quiz-modal {
            display: none; position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0, 0, 0, 0.8); z-index: 100;
            align-items: center; justify-content: center; backdrop-filter: blur(5px);
        }
        .quiz-card {
            background: white; padding: 40px; border-radius: 20px; max-width: 800px; width: 90%;
            box-shadow: 0 20px 50px rgba(0,0,0,0.2); max-height: 90vh; overflow-y: auto;
        }

        .question-item { margin-bottom: 25px; border-bottom: 1px solid #f1f5f9; padding-bottom: 20px; }
        .question-text { font-weight: 700; margin-bottom: 15px; font-size: 1rem; color: var(--text-dark); line-height: 1.5; }
        
        .option-label {
            display: flex; align-items: flex-start; gap: 10px;
            padding: 15px; border: 2px solid #e2e8f0; border-radius: 10px; 
            margin-bottom: 8px; cursor: pointer; transition: all 0.2s; background: white;
        }
        .option-label:hover { border-color: var(--blue-advanced); background: #f0f9ff; }
        .option-label input:checked + span { color: var(--blue-advanced); font-weight: bold; }
        .option-label span { font-size: 0.95rem; line-height: 1.4; }
        .option-label:has(input:checked) { border-color: var(--blue-advanced); background: #e0f2fe; }

        .result-screen { text-align: center; display: none; }
        .emoji-result { font-size: 4rem; margin-bottom: 10px; display: block; }

        @media (max-width: 768px) {
            .container { grid-template-columns: 1fr; }
            .video-section { position: relative; top: 0; }
        }
    </style>
</head>
<body>

    <div class="bg-image"></div>
    <div class="bg-overlay"></div>

    <div class="nav-top">
        <a href="training-hub.html">&larr; Kembali ke Library</a>
    </div>

    <div class="container">
        
        <div class="video-section">
            <div class="video-box" id="videoScreen">
                <div style="text-align: center; z-index: 2; padding: 20px;">
                    <h2 style="margin-bottom: 5px; color: white;">üé• Webinar: Omnichannel Strategy</h2>
                    <p style="color: rgba(255,255,255,0.8); font-size: 0.9rem; margin-bottom: 20px;">Website Mandiri, SEO & Data Analytics</p>
                    <button class="btn btn-primary" style="width: auto; padding: 10px 30px;" onclick="playVideo()">Putar Video</button>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="videoProgress"></div>
                </div>
            </div>

            <div class="info-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <span style="color: var(--text-muted); font-size: 0.9rem;">Status Level Advanced</span>
                    <strong id="statusLabel" style="color: var(--blue-advanced);">Sedang Berlangsung...</strong>
                </div>
                <p style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 15px; line-height: 1.5;">
                    üí° <strong>Aturan 90%:</strong> Tonton materi tentang Website Strategy & Data Analytics hingga 90% durasi untuk membuka Expert Assessment.
                </p>
                <button id="btnQuiz" class="btn btn-disabled" disabled onclick="openQuiz()">
                    üîí Ambil Expert Assessment
                </button>
            </div>
        </div>

        <div>
            <div class="syllabus-card">
                <h3 style="margin-bottom: 20px; color: var(--text-dark); font-size: 1.1rem;">üöÄ Materi Digital Advanced</h3>
                
                <div class="syllabus-item active">
                    <span class="icon-type">üé•</span>
                    <div>
                        <div style="font-weight: 600;">Website & Omnichannel Sync</div>
                        <div style="font-size: 0.75rem; color: var(--blue-advanced);">Sedang Diputar</div>
                    </div>
                </div>
                <div class="syllabus-item"><span class="icon-type">üìò</span><div><div style="font-weight: 600;">Playbook: Integrasi E-commerce</div><a href="#" style="font-size: 0.75rem; color: var(--golden-orange);">Download Panduan</a></div></div>
                <div class="syllabus-item"><span class="icon-type">üë•</span><div><div style="font-weight: 600;">Forum Diskusi</div><a href="#" style="font-size: 0.75rem; color: var(--golden-orange);">Grup Web Bisnis</a></div></div>
                <div class="syllabus-item"><span class="icon-type">üí°</span><div><div style="font-weight: 600;">Success Story</div><div style="font-size: 0.75rem;">Kisah Sukses Platform Mandiri</div></div></div>
            </div>

            <div class="syllabus-card" style="margin-top: 20px; border: 2px solid var(--forest-green);">
                <h4 style="color: var(--forest-green); margin-bottom: 10px; font-weight: 700;">Mentoring Ahli</h4>
                <p style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 15px;">
                    Perlu strategi SEO & Ads Spend >10 Juta/bulan? Konsultasi dengan expert kami.
                </p>
                <button style="padding: 10px; width: 100%; background: #f0fdf4; color: var(--forest-green); border: 1px solid var(--forest-green); border-radius: 8px; cursor: pointer; font-weight: 600;">
                    üë®‚Äçüè´ Booking Mentor Expert
                </button>
            </div>
        </div>

    </div>

    <div class="quiz-modal" id="quizModal">
        <div class="quiz-card">
            
            <div id="quizContent">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h3 style="color: var(--blue-advanced);">üî• Final Expert Assessment</h3>
                    <span style="color: var(--text-muted); font-size: 0.9rem; background: #f1f5f9; padding: 5px 10px; border-radius: 8px;">Min. Skor: 80 (Benar 4/5)</span>
                </div>
                <div style="height: 1px; background: #e2e8f0; margin: 15px 0 25px;"></div>

                <div class="question-item">
                    <p class="question-text">1. [ANALISIS DATA] Anda menjual produk dengan Margin Rp 100rb. Iklan FB Ads menghasilkan CPA (Cost per Acquisition) Rp 120rb. Apa kesimpulan strategis yang tepat?</p>
                    <label class="option-label"><input type="radio" name="q1" value="wrong"><span>Iklan sangat bagus karena mendatangkan banyak penjualan, lanjutkan scaling.</span></label>
                    <label class="option-label"><input type="radio" name="q1" value="correct"><span>Boncos (Rugi) di awal. Strategi ini hanya valid jika Anda memiliki LTV (Lifetime Value) > Rp 220rb.</span></label>
                    <label class="option-label"><input type="radio" name="q1" value="wrong"><span>Perlu menurunkan harga jual produk agar lebih laku.</span></label>
                </div>

                <div class="question-item">
                    <p class="question-text">2. [SEO STRATEGY] Website Anda memiliki konten yang sama persis dengan toko di Marketplace. Apa solusi teknis agar Google meranking Website Anda?</p>
                    <label class="option-label"><input type="radio" name="q2" value="correct"><span>Menggunakan 'Canonical Tag' pada halaman website.</span></label>
                    <label class="option-label"><input type="radio" name="q2" value="wrong"><span>Menuliskan kata kunci sebanyak 100 kali di footer website.</span></label>
                    <label class="option-label"><input type="radio" name="q2" value="wrong"><span>Melaporkan link Marketplace ke Google sebagai spam.</span></label>
                </div>

                <div class="question-item">
                    <p class="question-text">3. [ADS STRATEGY] Anda ingin menargetkan orang yang sudah 'Add to Cart' tapi belum 'Purchase'. Fitur apa yang digunakan?</p>
                    <label class="option-label"><input type="radio" name="q3" value="wrong"><span>Interest Targeting (Minat 'Belanja Online').</span></label>
                    <label class="option-label"><input type="radio" name="q3" value="wrong"><span>Lookalike Audience 1%.</span></label>
                    <label class="option-label"><input type="radio" name="q3" value="correct"><span>Custom Audience (Retargeting) exclude 'Purchase'.</span></label>
                </div>

                <div class="question-item">
                    <p class="question-text">4. [DATA OWNERSHIP] Mengapa brand besar berinvestasi mahal membangun Website sendiri?</p>
                    <label class="option-label"><input type="radio" name="q4" value="wrong"><span>Agar terlihat keren di mata investor.</span></label>
                    <label class="option-label"><input type="radio" name="q4" value="correct"><span>Memiliki 'First-Party Data' & kontrol penuh atas pelanggan (CRM).</span></label>
                    <label class="option-label"><input type="radio" name="q4" value="wrong"><span>Karena di website sendiri bebas pajak.</span></label>
                </div>

                <div class="question-item">
                    <p class="question-text">5. [OPERASIONAL] Apa risiko terbesar jika API sinkronisasi stok Omnichannel mengalami delay saat Flash Sale?</p>
                    <label class="option-label"><input type="radio" name="q5" value="wrong"><span>Admin toko bingung membalas chat.</span></label>
                    <label class="option-label"><input type="radio" name="q5" value="correct"><span>Overselling: Barang terjual melebihi stok fisik, menyebabkan penalti toko.</span></label>
                    <label class="option-label"><input type="radio" name="q5" value="wrong"><span>Harga produk berubah menjadi nol rupiah.</span></label>
                </div>

                <div style="display:flex; gap:10px; margin-top:30px;">
                    <button class="btn btn-disabled" style="background:transparent; border:1px solid #cbd5e1; color:#64748b;" onclick="closeQuiz()">Batal</button>
                    <button class="btn btn-primary" onclick="submitQuiz()">Kirim Jawaban Akhir</button>
                </div>
            </div>

            <div id="resultSuccess" class="result-screen">
                <span class="emoji-result">üèÜ</span>
                <h2 style="color: var(--blue-advanced);">EXPERT CERTIFIED!</h2>
                <p style="color: var(--text-muted);">Luar Biasa! Analisis Anda tajam. Skor: <span id="scoreValSuccess"></span></p>
                
                <button class="btn btn-cert" onclick="generateCertificate()">
                    üìú Download Sertifikat Expert
                </button>

                <div style="height: 1px; background: #e2e8f0; margin: 20px 0;"></div>
                
                <p style="font-size: 0.9rem; color: var(--text-muted);">Fitur <strong>Omnichannel Tools & Financing Advanced</strong> telah dibuka.</p>
                <button class="btn btn-success" onclick="finishCourse()">Kembali ke Training Hub &rarr;</button>
            </div>

            <div id="resultFail" class="result-screen">
                <span class="emoji-result">üìâ</span>
                <h2 style="color: var(--golden-orange);">Analisis Belum Tepat</h2>
                <p style="color: var(--text-muted);">Skor Anda: <span id="scoreValFail"></span>/100</p>
                <div style="background:#fefce8; padding:15px; margin:15px 0; border-radius:8px; font-size:0.85rem; text-align:left; color:#854d0e;">
                    <strong>Evaluasi:</strong><br>
                    Pemahaman tentang metrik keuangan iklan (ROAS) atau teknis integrasi data masih perlu diperdalam.
                </div>
                <button class="btn btn-warning" onclick="retryCourse()">üîÑ Review Materi & Coba Lagi</button>
            </div>

        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyBIaLzkNM0KqPVKxuMNmardLqcrr2kYTWQ",
            authDomain: "database-idbm.firebaseapp.com",
            projectId: "database-idbm",
            storageBucket: "database-idbm.firebasestorage.app",
            messagingSenderId: "1052290789133",
            appId: "1:1052290789133:web:36b513630b7a87154eca44",
            measurementId: "G-EQLBB94DY2"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUserName = "Peserta UMKM";

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const docSnap = await getDoc(doc(db, "users_umkm", user.uid));
                if (docSnap.exists()) {
                    currentUserName = docSnap.data().nama_lengkap;
                }
            }
        });

        // --- VIDEO SIMULATION ---
        let videoDuration = 5; 
        let currentTime = 0;
        let videoInterval;

        window.playVideo = function() {
            const screen = document.getElementById('videoScreen');
            const btn = screen.querySelector('button');
            const title = screen.querySelector('h2');
            
            btn.style.display = 'none';
            title.innerText = "‚ñ∂ Sedang Memutar...";
            title.style.color = "var(--blue-advanced)";

            videoInterval = setInterval(() => {
                currentTime++;
                const percentage = (currentTime / videoDuration) * 100;
                document.getElementById('videoProgress').style.width = `${percentage}%`;

                if (percentage >= 90) unlockQuizButton();

                if (currentTime >= videoDuration) {
                    clearInterval(videoInterval);
                    title.innerText = "‚úÖ Materi Selesai";
                    title.style.color = "#10b981";
                }
            }, 1000);
        }

        function unlockQuizButton() {
            const btnQuiz = document.getElementById('btnQuiz');
            const label = document.getElementById('statusLabel');
            
            if (btnQuiz.disabled) {
                btnQuiz.disabled = false;
                btnQuiz.classList.remove('btn-disabled');
                btnQuiz.classList.add('btn-primary');
                btnQuiz.innerHTML = "üìù Ambil Expert Assessment";
                label.innerText = "Siap Validasi";
                label.style.color = "var(--blue-advanced)";
            }
        }

        // --- QUIZ LOGIC ---
        window.openQuiz = () => document.getElementById('quizModal').style.display = 'flex';
        window.closeQuiz = () => document.getElementById('quizModal').style.display = 'none';

        window.submitQuiz = function() {
            for(let i=1; i<=5; i++) {
                if(!document.querySelector(`input[name="q${i}"]:checked`)) {
                    alert(`Pertanyaan nomor ${i} belum dijawab!`);
                    return;
                }
            }

            let score = 0;
            const answers = [
                document.querySelector('input[name="q1"]:checked').value,
                document.querySelector('input[name="q2"]:checked').value,
                document.querySelector('input[name="q3"]:checked').value,
                document.querySelector('input[name="q4"]:checked').value,
                document.querySelector('input[name="q5"]:checked').value
            ];

            answers.forEach(ans => { if(ans === 'correct') score += 20; });

            document.getElementById('quizContent').style.display = 'none';

            if (score >= 80) {
                document.getElementById('resultSuccess').style.display = 'block';
                document.getElementById('scoreValSuccess').innerText = score;
                saveProgressToFirebase(true);
            } else {
                document.getElementById('resultFail').style.display = 'block';
                document.getElementById('scoreValFail').innerText = score;
            }
        }

        window.retryCourse = function() {
            document.getElementById('quizModal').style.display = 'none';
            document.getElementById('quizContent').style.display = 'block';
            document.getElementById('resultFail').style.display = 'none';
            document.querySelectorAll('input[type="radio"]').forEach(el => el.checked = false);
        }

        window.finishCourse = function() {
            window.location.href = "training-hub.html";
        }

        // --- GENERATE CERTIFICATE ---
        window.generateCertificate = function() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({ orientation: 'landscape' });

            doc.setDrawColor(14, 165, 233); // Sky Blue
            doc.setLineWidth(3);
            doc.rect(10, 10, 277, 190);

            doc.setFont("helvetica", "bold");
            doc.setFontSize(24);
            doc.setTextColor(15, 23, 42);
            doc.text("SERTIFIKAT KEAHLIAN - TINGKAT AHLI", 148.5, 40, null, null, "center");

            doc.setFontSize(12);
            doc.setTextColor(100);
            doc.text("ID-TRIBE Training Hub", 148.5, 50, null, null, "center");

            doc.setFont("helvetica", "normal");
            doc.setFontSize(16);
            doc.setTextColor(0);
            doc.text("Diberikan kepada:", 148.5, 80, null, null, "center");

            doc.setFont("times", "bolditalic");
            doc.setFontSize(36);
            doc.setTextColor(14, 165, 233);
            doc.text(currentUserName, 148.5, 100, null, null, "center");

            doc.setFont("helvetica", "normal");
            doc.setFontSize(14);
            doc.setTextColor(0);
            doc.text("Telah lulus ujian validasi kompetensi strategis:", 148.5, 125, null, null, "center");

            doc.setFont("helvetica", "bold");
            doc.setFontSize(20);
            doc.text("DIGITAL STRATEGY, OMNICHANNEL & DATA ANALYTICS", 148.5, 140, null, null, "center");

            const date = new Date().toLocaleDateString('id-ID', { year: 'numeric', month: 'long', day: 'numeric' });
            doc.setFontSize(12);
            doc.setFont("helvetica", "normal");
            doc.text(`Jakarta, ${date}`, 148.5, 165, null, null, "center");

            doc.save(`Sertifikat_Expert_${currentUserName}.pdf`);
        }

        // --- DATABASE UPDATE ---
        async function saveProgressToFirebase(isPassed) {
            const user = auth.currentUser;
            if (user && isPassed) {
                try {
                    await updateDoc(doc(db, "users_umkm", user.uid), {
                        completed_courses: arrayUnion("digital_advanced"),
                        "health_check_result.Digital & Marketing.level": "Advanced",
                        "health_check_result.Digital & Marketing.score": 15, 
                        unlocked_features: arrayUnion("advanced_marketing_tools", "omnichannel_dashboard")
                    });
                    console.log("Database Updated");
                } catch (e) {
                    console.error("Error saving:", e);
                }
            }
        }
    </script>
</body>
</html>