<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Expert Coaching - ID-TRIBE</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Plus+Jakarta+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <script type="module" src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>

    <style>
        /* --- 1. MODERN VARIABLES --- */
        :root {
            --primary: #059669; --primary-dark: #047857; --accent: #f59e0b;
            --live-red: #ef4444; --dark: #0f172a; --light: #f8fafc;
            --glass-bg: rgba(255, 255, 255, 0.9);
            --glass-border: 1px solid rgba(255, 255, 255, 0.6);
            --font-head: 'Outfit', sans-serif; --font-body: 'Plus Jakarta Sans', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--font-body); background-color: #ecfdf5; color: var(--dark); min-height: 100vh; overflow-x: hidden; }

        /* ORNAMENTS */
        .bg-shapes { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }
        .blob { position: absolute; border-radius: 50%; filter: blur(80px); opacity: 0.6; animation: float 10s infinite alternate; }
        .blob-1 { top: -10%; left: -10%; width: 500px; height: 500px; background: #d1fae5; }
        .blob-2 { bottom: 10%; right: -5%; width: 400px; height: 400px; background: #fef3c7; animation-delay: -5s; }
        @keyframes float { 0% { transform: translateY(0); } 100% { transform: translateY(30px); } }

        /* CONTAINER */
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }

        /* HEADER */
        .nav-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .back-btn { background: white; color: var(--primary); padding: 10px 20px; border-radius: 50px; text-decoration: none; font-weight: 700; display: flex; align-items: center; gap: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); transition: 0.3s; }
        .back-btn:hover { transform: translateX(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }

        /* --- LIVE STREAMING SECTION --- */
        .live-hero {
            background: white; border-radius: 24px; overflow: hidden;
            box-shadow: 0 20px 50px rgba(0,0,0,0.1); margin-bottom: 40px;
            display: grid; grid-template-columns: 1.5fr 1fr; border: 1px solid white;
        }

        .video-container {
            background: #000; position: relative; aspect-ratio: 16/9;
            display: flex; align-items: center; justify-content: center;
        }
        .live-tag { position: absolute; top: 20px; left: 20px; background: var(--live-red); color: white; padding: 5px 12px; border-radius: 4px; font-weight: 800; font-size: 0.8rem; display: flex; align-items: center; gap: 5px; animation: pulse 1.5s infinite; z-index: 10; }
        .viewer-count { position: absolute; bottom: 20px; left: 20px; background: rgba(0,0,0,0.6); color: white; padding: 5px 10px; border-radius: 4px; font-size: 0.8rem; display: flex; align-items: center; gap: 5px; z-index: 10; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        /* CHAT SECTION (Side of Video) */
        .chat-panel { display: flex; flex-direction: column; height: 100%; border-left: 1px solid #e2e8f0; background: #f8fafc; }
        .chat-header { padding: 15px; background: white; border-bottom: 1px solid #e2e8f0; font-weight: 700; color: var(--primary); display: flex; justify-content: space-between; }
        .chat-messages { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; max-height: 400px; }
        
        .chat-bubble { padding: 10px 12px; background: white; border-radius: 0 12px 12px 12px; font-size: 0.9rem; max-width: 90%; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
        .chat-user { font-size: 0.75rem; font-weight: 700; color: var(--text-gray); margin-bottom: 2px; display: block; }
        .chat-input-area { padding: 15px; background: white; border-top: 1px solid #e2e8f0; display: flex; gap: 10px; }
        
        .material-link { 
            background: #e0f2fe; color: #0284c7; padding: 10px; border-radius: 8px; margin-bottom: 10px; font-size: 0.85rem; 
            display: flex; align-items: center; gap: 10px; text-decoration: none; font-weight: 600; border: 1px dashed #0284c7;
        }

        /* --- MENTOR LIST --- */
        .mentor-section { margin-top: 50px; }
        .section-head { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 20px; }
        .filter-scroll { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; }
        .filter-chip { background: white; padding: 8px 16px; border-radius: 50px; border: 1px solid #e2e8f0; cursor: pointer; font-size: 0.9rem; transition: 0.3s; white-space: nowrap; }
        .filter-chip.active { background: var(--accent); color: white; border-color: var(--accent); }

        .mentor-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; }
        .mentor-card { background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.03); transition: 0.3s; border: 1px solid white; cursor: pointer; }
        .mentor-card:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); border-color: var(--primary); }
        
        .mentor-head { padding: 25px; text-align: center; background: linear-gradient(135deg, #f0fdf4, #fff); border-bottom: 1px dashed #e2e8f0; }
        .mentor-img { width: 90px; height: 90px; border-radius: 50%; object-fit: cover; border: 4px solid white; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 10px; }
        .mentor-body { padding: 20px; }
        
        /* RESPONSIVE */
        @media (max-width: 768px) {
            .live-hero { grid-template-columns: 1fr; display: block; }
            .video-container { height: 250px; }
            .chat-messages { max-height: 300px; }
        }
    </style>
</head>
<body>

    <div class="bg-shapes">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
    </div>

    <div class="container">
        
        <div class="nav-header">
            <a href="training-hub.html" class="back-btn"><i class="fas fa-arrow-left"></i> Kembali</a>
            <div style="font-family: var(--font-head); font-weight: 800; font-size: 1.2rem; color: var(--primary-dark);">LIVE <span style="color:var(--accent);">COACHING</span></div>
        </div>

        <div id="streamingArea">
            <div class="live-hero" style="text-align:center; padding:50px; display:block;">
                <i class="fas fa-video-slash" style="font-size:3rem; color:#cbd5e1; margin-bottom:15px;"></i>
                <h3 style="color:#64748b;">Belum ada sesi Live saat ini.</h3>
                <p style="color:#94a3b8; font-size:0.9rem;">Cek jadwal mentor di bawah untuk booking sesi.</p>
             </div>
        </div>

        <div class="mentor-section">
            <div class="section-head">
                <div>
                    <h2 style="font-family:var(--font-head); font-weight:800; color:var(--dark); margin-bottom:5px;">Pilih Mentor Ahli</h2>
                    <p style="color:#64748b; font-size:0.95rem;">Booking sesi privat atau tunggu sesi live mereka.</p>
                </div>
            </div>

            <div class="filter-scroll">
                <div class="filter-chip active" onclick="filterMentors('all', this)">Semua</div>
                <div class="filter-chip" onclick="filterMentors('Marketing', this)">Marketing</div>
                <div class="filter-chip" onclick="filterMentors('Halal', this)">Halal</div>
                <div class="filter-chip" onclick="filterMentors('Finance', this)">Keuangan</div>
                <div class="filter-chip" onclick="filterMentors('Export', this)">Ekspor</div>
            </div>
            <br>

            <div class="mentor-grid" id="mentorContainer">
                </div>
        </div>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, onSnapshot, query, orderBy, where, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // ... (KODE CONFIG FIREBASE SAMA SEPERTI SEBELUMNYA) ...
        const firebaseConfig = {
            apiKey: "AIzaSyBIaLzkNM0KqPVKxuMNmardLqcrr2kYTWQ",
            authDomain: "database-idbm.firebaseapp.com",
            projectId: "database-idbm",
            storageBucket: "database-idbm.firebasestorage.app",
            messagingSenderId: "1052290789133",
            appId: "1:1052290789133:web:36b513630b7a87154eca44",
            measurementId: "G-EQLBB94DY2"
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;
        let selectedMentorName = ""; // Variabel baru untuk menyimpan siapa yang dibooking

        // ... (KODE AUTH & RENDER MENTOR SAMA) ...

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const docSnap = await getDoc(doc(db, "users_umkm", user.uid));
                if (docSnap.exists()) {
                    currentUser = {
                        uid: user.uid,
                        name: docSnap.data().nama_lengkap,
                        email: docSnap.data().email
                    };
                }
                renderMentors('all');
                // ... logic lain
            }
        });

        // UPDATE DI SINI: Menyimpan nama mentor saat modal dibuka
        window.openBooking = function(name, spec, img) {
            selectedMentorName = name; // Simpan nama mentor
            document.getElementById('bookingModal').style.display = 'flex';
            document.getElementById('modalName').innerText = name;
            document.getElementById('modalSpec').innerText = spec;
            document.getElementById('modalImg').src = `https://ui-avatars.com/api/?name=${img}&background=random`;
        }

        // UPDATE DI SINI: Simpan ke Firestore
        window.processBooking = async function() {
            const btn = document.querySelector('#bookingModal button[onclick="processBooking()"]');
            btn.innerHTML = "Memproses...";
            btn.disabled = true;

            try {
                // Simpan data booking ke collection 'bookings'
                await addDoc(collection(db, "bookings"), {
                    coach_name: selectedMentorName, // Nama mentor yang dituju
                    user_uid: currentUser.uid,
                    user_name: currentUser.name,
                    user_email: currentUser.email,
                    session_topic: "Konsultasi Private", // Bisa dibuat dinamis inputnya
                    date: new Date(), // Tanggal booking dibuat
                    schedule_date: "Senin, 10:00", // Hardcoded dari pilihan UI (bisa dibuat dinamis)
                    status: "Pending", // Status awal
                    price: 150000
                });

                alert("Booking Berhasil! Silakan tunggu konfirmasi Coach.");
                window.closeBooking();

            } catch (e) {
                console.error(e);
                alert("Gagal melakukan booking: " + e.message);
            } finally {
                btn.innerHTML = "Booking (Rp 150rb)";
                btn.disabled = false;
            }
        }
        
        // ... (SISA KODE LAINNYA TETAP SAMA) ...
        
        // Pastikan fungsi helper lain ada (filterMentors, renderMentors, closeBooking, dll)
        // ...
    </script>
</body>
</html>